<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles.css">
  <title>Home | Hive</title>
</head>

<body>
  <% if (locals.user) { %>
  <header>
    <nav>
      <label for="id-show-menu" class="show-menu">
        <div class="nav-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu-icon lucide-menu">
            <path d="M4 12h16" />
            <path d="M4 18h16" />
            <path d="M4 6h16" />
          </svg>
        </div>
      </label>
      <input type="checkbox" id="id-show-menu" class="checkbox-menu" role="button">
      <div class="menu-block">
        <ul class="navUL">
          <li><a href="/new-message">New Message</a></li>
          <li><a href="/log-out">Logout</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main class="home">
    <section>
      <p class="main-msg">Welcome to Hive <%= locals.user.first_name%> </p>
      <% if (locals.user.membership_status !== 'admin' && locals.user.membership_status !== 'premium' ) {%>
      <a href="/membership">Join Hive Premium</a>
      <%  } %>
      <% if (locals.user.membership_status !== 'admin' ) { %>
      <a href="/admin">Log In as Admin</a>
      <% } %>
      <% if (messages.length === 0) { %>
      <p class="fall-back-msg">No messages at this moment.</p>
      <% } %>
      <% messages.forEach(msg => { %>
      <% if (locals.user.membership_status == 'admin') { %>
      <div class="msg-card">
        <div class="msg-body">
          <p class="msg-title"><%- msg.title %></p>
          <p class="msg-content"><%- msg.content %></p>
          <p class="timestamp"><%= msg.created_at %></p>
          <p class="name">
            from: @<%= msg.first_name %> <%= msg.last_name %>
          </p>
        </div>
        <form action="/delete" method="POST" style="display:inline;">
          <input type="hidden" name="messageId" value="<%= msg.id %>">
          <button class="del-btn" type="submit">Delete</button>
        </form>
      </div>
      <% } else if (locals.user.membership_status == 'premium')  { %>
      <p class="name">
        <%= msg.first_name %> <%= msg.last_name %>
      </p>

      <p class="timestamp"><%= msg.created_at %></p>
      <p class="msg-title"><%- msg.title %></p>
      <p class="msg-content"><%- msg.content %></p>
      <% } else { %>
      <p class="msg-title"><%- msg.title %></p>
      <p class="msg-content"><%- msg.content %></p>
      <% } %>
      <% }) %>

      <% } else { %>
      <main class="home">
        <section>
          <div class="form-container">
            <p class="title">Login</p>
            <form class="form" action="/log-in" method="POST">
              <div class="input-group">
                <label for="email">Email</label>
                <input type="email" name="email" id="email" placeholder="" />
              </div>
              <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" placeholder="" />
              </div>
              <% if (errors.error && errors.error.length > 0) { %>
              <div class="errors">
                <% errors.error.forEach(function(message) { %>
                <p class="error"><%= message %></p>
                <% }); %>
              </div>
              <% } %>
              <button class="sign" type="submit">Sign in</button>
              <p class="signup">Don't have an account?
                <a rel="noopener noreferrer" href="/sign-up">Sign up</a>
              </p>
              <p class="subtitle">Hive members messages</p>
              <% messages.forEach(msg => { %>
              <div class="msg-card">
                <div class="msg-body">
                  <p class="msg-title">
                    <%- msg.title %>
                  <p class="msg-content"><%- msg.content %></p>
                  </p>
                  <p class="name">
                    from: @<%= author %>
                  </p>
                </div>
              </div>
              <%})%>
            </form>
          </div>
        </section>
      </main>
      <% } %>

    </section>
  </main>
  <footer>

  </footer>

</body>

</html>